---
title: "Профильное образование. Миф или реальность?"
author: "Никифорова Анна Дмитриевна"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE)
```
## Аннотация

Цель исследования - проверить, можно ли делить предметы на технические, гуманитарные и т.д. В рамках данной работы изучены результаты ВсОШ муниципального уровня за 2020-2021 год по городу Иваново, на основании результатов выделены группы предметов, по которым школьники чаще одновременно занимают призовые места. Группы соответствуют эмпирическому разделению предметов на физико-математические, химико-биологические и социально-гуманитарные.

## Ключевые слова

Профильное образование, школа, ВсОШ

## Введение

"Гуманитарий или технарь?" - этим вопросом задаётся большинство российских школьников после девятого класса, собирающихся продолжать обучение в школе. Так как в 10-11 классах введено профильное образование, проблема самоопределения стоит довольно остро. Традиционно существуют такие профили, как физико-математический, социально-гуманитарный, социально-экономический, а также химико-биологический. Целью данного исследования является проверка, действительно ли склонности человека можно классифицировать в соответствии с указанными выше профилями.

В качестве объекта исследования было решено взять данные муниципального этапа ВсОШ [1][link1]. Это продиктовано наличием данных в свободном доступе; тем, что на муниципальный этап проходят люди со знаниями выше среднего по предмету; а также тем, что на данном этапе выступают ребята с 7 по 11 класс включительно, тогда как на региональном этапе можно выступать лишь с 9-го. Учителя предлагают всем школьникам вне зависимости от их успеваемости и интересов участвовать в школьном этапе ВсОШ, набравшие высокий балл ребята проходят на муниципальный этап и занимают там призовые места, поэтому выборку можно считать репрезентативной.

Предпосылкой данного исследования является то, что призовые места на олимпиаде отражают интересы и склонности учащихся. Так как один и тот же человек может занять призовое место на нескольких олимпиадах, по этим данным можно сделать вывод о том, как часто люди интересуются теми или иными предметами одновременно.

## Основная часть
### Сбор данных

Данные, на которых проводится исследование - результаты муниципального этапа ВсОШ по городу Иваново за 2020-2021 год [2][link2]. Было решено не брать данные за несколько лет, чтобы избежать корреляции, вызванной тем, что многие школьники участвуют и побеждают в олимпиадах несколько лет подряд.

```{r, eval=FALSE, include=FALSE}
# необходимые для работы кода библиотеки
install.packages(c("rvest", "dplyr", "stringr", "assertr", "openxlsx", "lsa", "pheatmap"))
```
```{r, include=FALSE}
library(pheatmap)
library(openxlsx)
library(rvest)
library(dplyr)
library(stringr)
library(assertr)
library(ggplot2)
library(lsa)
```

Данные парсятся с сайта ЦРДО (Центра развития детской одарённости города Иваново). Скачиваются только те файлы, в которых присутствуют результаты за 7-11 классы, а также за 8-11 в случае химии.

```{r, eval=FALSE, include=FALSE}
dir.create("data2020-2021", showWarnings=FALSE)
connection <- url("https://xn----7sbfbblhs1ckbe1bnb.xn--p1ai/olimp/results/mun/20202021/", "rb")
initial_web_page <- read_html(connection)

all_rows_from_table <- initial_web_page %>% html_element(".tbl") %>% html_nodes("tr") %>% html_nodes("a") 
some_rows_from_table <- all_rows_from_table[seq(1, length(all_rows_from_table), 3)]

filenames <- some_rows_from_table %>% html_attr("title")

download_links <- some_rows_from_table %>% html_attr("href")
download_links <- str_replace(download_links, "../../../../", "https://xn----7sbfbblhs1ckbe1bnb.xn--p1ai/")

for(i in c(1:length(download_links))){
  if (grepl("11", filenames[i], fixed=TRUE)){
    download.file(download_links[i], destfile=paste("./data2020-2021", paste(filenames[i], ".xlsx", sep=""), sep="/"), mode="wb")
  }
}
```

Предметы, которые рассматриваются в данном исследовании: 
``` {r} 
all_subjects <- c("русский язык", "литература", "английский язык", "искусство", "обществознание", "история", "право", "экономика", "математика", "информатика", "физика", "астрономия", "химия", "биология", "экология", "география")
print(all_subjects)
```

Для того, чтобы изучить взаимосвязь между предметами, предлагается следующий подход. Представим исходные данные об успеваемости учащихся на олимпиаде в виде таблицы, где строки - это учащиеся, столбцы - названия предметов, а на пересечении стоят нули и единицы, где единица означает наличие призового места (победитель или призёр) на олимпиаде по предмету у данного учащегося, а ноль - отсутствие (либо не призовое место, либо в принципе не участвовал). Таким образом, каждый предмет будет представлен в виде вектора из нулей и единиц. Схожесть векторов можно будет выяснить, посчитав косинусное расстояние между ними. 

```{r, include=FALSE}
df <- data.frame()
for (file in list.files(path = "./data2020-2021/")){
  subject_name <- names(which(sapply(all_subjects, 
                                     function(x){grepl(x, tolower(file), fixed=T)})))
  if (length(subject_name) == 0){
    next
  }
  curr_df <- data.frame()
  for (sheet in getSheetNames(paste("./data2020-2021/", file, sep=""))){
    curr_df_inner <- read.xlsx(paste("./data2020-2021/", file, sep=""), sheet, 9)
    curr_df_inner <- apply(curr_df_inner, 1, function(row){
      fio <- gsub("\\s+", " ", 
                  str_trim(paste(row["Фамилия"], row["Имя"], row["Отчество"], sep=" ")))
      status <- ifelse(((tolower(row["Тип.диплома"]) == "победитель") || 
                          (tolower(row["Тип.диплома"]) == "призер") ||
                          (tolower(row["Тип.диплома"]) == "призёр")), 1, 0)
      fio <- gsub("ё", "е", fio)
      return(c(fio, row["Номер.школы"], row["Номер.класса"], status))
    })
    curr_df_inner <- data.frame(t(curr_df_inner))
    colnames(curr_df_inner) <- c("ФИО", "Школа", "Класс", subject_name)
    if (length(curr_df) == 0){
      curr_df <- curr_df_inner
    }else{
      curr_df <- rbind(curr_df, curr_df_inner)
    }
  }
  if (length(df) == 0){
    df <- curr_df
  }else{
    df <- full_join(df, curr_df, by=c("ФИО", "Школа", "Класс"))
  }
}
df[is.na(df)] <- 0
df <- df[df$ФИО != "X X X",]  
write.csv(df, "./csv2020-2021.csv", row.names=F)
```

### Анализ

```{r, include=FALSE}
df <- read.csv("./csv2020-2021.csv")
df["Всего_призовых_мест"] <- rowSums(select(df, -c(ФИО, Школа, Класс)))
df_trunc <- df[(df["Всего_призовых_мест"] > 0) & (df["Класс"] > 6),]
```

График, отражающий количество призовых мест на олимпиаде в целом. Оно напрямую зависит от количества участников по тому или иному предмету.

```{r, fig.align="center"}
vectors <- df_trunc[,c("русский.язык", "литература", "английский.язык", "искусство",
                       "обществознание", "история", "право", "экономика",
                       "математика", "информатика", "физика", "астрономия",
                       "химия", "биология", "экология", "география")]
chart_df <- data.frame(value=colSums(vectors))
ggplot(chart_df, aes(x=colnames(vectors), y=value))+
  geom_bar(stat="identity", fill="cornflowerblue")+
  labs(title = "Количество призовых мест по различным предметам", 
       x = "Предметы", y = "Количество") +
  theme(axis.text.x = element_text(angle = 90, vjust=0.3, hjust=1, size=10),
        plot.title = element_text(hjust = 0.5))
```

График, отражающий количество людей, занявших призовые места на олимпиадах, сгруппированных по классу обучения и количеству призовых мест. По графику видно, что между классами нет значительной разницы. Чаще школьники занимают места в одной олимпиаде, иногда - в двух или трёх, очень редко в четырёх и более.

```{r, fig.align="center"}
ggplot(df_trunc, aes(x=Всего_призовых_мест))+
  geom_bar(fill="cornflowerblue")+
  geom_text(aes(label = ..count..), stat="count", vjust=-0.2, 
            size=3.5, colour="blue")+
  facet_grid(~Класс)+
  labs(x = "Количество призовых мест (без учета тех, кто ничего не занял)",
  y = "Количество",
  title = "Количество людей, занявших призовые места на олимпиадах, 
по классу и количеству призовых мест")
```

Подсчёт схожести векторов путём вычисления косинусного расстояния между ними и наглядное представление получившейся матрицы.

```{r, fig.width=7, fig.height=7, fig.align="center"}
cos_dists <- data.frame(cosine(data.matrix(vectors)))
heatmap_full <- pheatmap(cos_dists, display_numbers=T, main="Близость предметов",
                         cluster_cols=F, cluster_rows=F)
```

Отображение предыдущего графика, но с добавлением иерархической кластеризации [3][link3].

```{r, fig.width=7, fig.height=7, fig.align="center"}
heatmap_repr <- pheatmap(cos_dists, display_numbers=T, main="Близость предметов", 
         cluster_cols=F, show_colnames=F, legend=F)
```

По графику можно увидеть, что предметы образуют следующие группы: физика + математика + экономика + информатика; химия + биология; экология + астрономия + география; русский язык + обществознание; история + право; английский язык + литература + искусство. При этом, группы с историей и обществознанием можно объединить в одну. Также в одну группу можно объединить химию, биологию, экологию, астрономию и географию. При дальнейшем объединении получаются следующие кластеры предметов: технический, кластер наук об окружающем мире, кластер социально-гуманитарных наук.

## Выводы

Анализ данных муниципального этапа ВсОШ по городу Иваново за 2020-2021 учебный год позволил выделить кластеры наиболее схожих между собой предметов, а именно технический кластер (физика, математика, экономика, информатика), кластер наук об окружающем мире (химия, биология, география, астрономия, экология), кластер социально-гуманитарных наук (русский и английский язык, обществознание, история, право, литература, искусство). Схожесть определена на основании того, как часто школьники занимают призовые места на нескольких предметах олимпиады одновременно. 

Выделенные кластеры приблизительно соответствуют существующему эмпирическому разделению школьных предметов. А значит, профильное образование с упором на определенные предметы удовлетворяет потребности современного образования и позволяет людям более полно реализовывать свой потенциал.


[link1]: https://olimpiada.ru/activity/43 
[link2]: https://xn----7sbfbblhs1ckbe1bnb.xn--p1ai/olimp/results/mun/20202021/ 
[link3]: https://neerc.ifmo.ru/wiki/index.php?title=%D0%98%D0%B5%D1%80%D0%B0%D1%80%D1%85%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F 
